<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Class Credit Bank</title>
<style>
  body {
    font-family: "Poppins", sans-serif;
    background-color: #f5f1e8; /* beige */
    color: #222;
    margin: 0;
    padding: 0;
  }

  header {
    background-color: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    padding: 20px 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  h1 {
    font-weight: 600;
  }

  .balance-card {
    background-color: white;
    border-radius: 20px;
    padding: 30px;
    margin: 40px auto;
    max-width: 600px;
    text-align: center;
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }

  .balance {
    font-size: 2.5em;
    margin: 20px 0;
    color: #1a73e8;
  }

  .glass-button {
    background: rgba(26, 115, 232, 0.2);
    color: #1a73e8;
    border: 1px solid rgba(26, 115, 232, 0.4);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 12px 30px;
    margin: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .glass-button:hover {
    background: rgba(26, 115, 232, 0.4);
    color: white;
  }

  .stock-market {
    background-color: white;
    margin: 40px auto;
    padding: 20px;
    max-width: 800px;
    border-radius: 20px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }

  canvas {
    width: 100%;
    height: 300px;
  }

  .ads {
    margin: 40px auto;
    max-width: 800px;
  }

  .ad-card {
    background-color: white;
    border-radius: 20px;
    padding: 20px;
    margin: 15px 0;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
  }

  /* Admin button (hidden pencil) */
  #adminBtn {
    position: fixed;
    top: 10px;
    left: 10px;
    font-size: 1.4em;
    background: none;
    border: none;
    cursor: pointer;
    color: transparent;
    text-shadow: 0 0 0 rgba(0,0,0,0);
  }
  .admin-visible {
    color: #1a73e8;
    text-shadow: 0 0 3px rgba(0,0,0,0.1);
  }

  /* Admin overlay */
  #adminPanel {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(6px);
    justify-content: center;
    align-items: center;
  }

  .admin-box {
    background: white;
    border-radius: 20px;
    padding: 20px;
    width: 90%;
    max-width: 700px;
    overflow-y: auto;
    max-height: 80%;
  }

  .admin-user {
    margin: 10px 0;
    border-bottom: 1px solid #ddd;
    padding: 10px;
  }

  input[type="number"] {
    width: 70px;
    padding: 5px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  .close-admin {
    float: right;
    cursor: pointer;
    font-weight: bold;
    color: red;
  }
</style>
</head>
<body>

<header>
  <h1>Class Credit Bank</h1>
  <button id="adminBtn" title="Admin">✏️</button>
</header>

<div class="balance-card">
  <h2>Welcome, <span id="username"></span></h2>
  <p>Your balance:</p>
  <div class="balance" id="balanceDisplay">0 Credits</div>
  <p>Daily Wage: <span id="wageDisplay">50</span> Credits</p>
  <button class="glass-button" onclick="takeLoan()">Take Loan</button>
  <button class="glass-button" onclick="goToMarketplace()">Go to Marketplace</button>
</div>

<div class="stock-market">
  <h2>Credit Stock Market</h2>
  <canvas id="stockCanvas"></canvas>
</div>

<div class="ads">
  <h2>Marketplace Highlights</h2>
  <div id="adsContainer"></div>
</div>

<!-- Admin Panel -->
<div id="adminPanel">
  <div class="admin-box">
    <span class="close-admin" onclick="closeAdmin()">X</span>
    <h2>Admin Controls</h2>
    <div id="adminUsers"></div>
  </div>
</div>

<script>
  const users = [
    "Sophia", "Alex", "William", "Pablo", "Leon", "Lexie", "Alfred", "Chloe", "Ariel", "Miya", "Noah"
  ];

  const currentUser = localStorage.getItem('currentUser');
  const balanceKey = currentUser + "_balance";
  const wageKey = currentUser + "_wage";
  const lastLoginKey = currentUser + "_lastLogin";

  document.getElementById("username").textContent = currentUser;
  let balance = parseInt(localStorage.getItem(balanceKey)) || 0;
  let wage = parseInt(localStorage.getItem(wageKey)) || 50;
  document.getElementById("balanceDisplay").textContent = balance + " Credits";
  document.getElementById("wageDisplay").textContent = wage;

  // Calculate daily wages
  const today = new Date();
  const lastLogin = localStorage.getItem(lastLoginKey);
  if (lastLogin) {
    const diffDays = Math.floor((today - new Date(lastLogin)) / (1000 * 60 * 60 * 24));
    if (diffDays > 0) {
      const earned = diffDays * wage;
      balance += earned;
      alert(`Welcome back! You earned ${earned} credits for ${diffDays} day(s)`);
    }
  }
  localStorage.setItem(balanceKey, balance);
  localStorage.setItem(lastLoginKey, today);
  document.getElementById("balanceDisplay").textContent = balance + " Credits";

  // Loan button
  function takeLoan() {
    const loanAmount = Math.floor(Math.random() * 500) + 100;
    balance += loanAmount;
    localStorage.setItem(balanceKey, balance);
    alert(`You took a loan of ${loanAmount} credits`);
    document.getElementById("balanceDisplay").textContent = balance + " Credits";
  }

  function goToMarketplace() {
    window.location.href = "marketplace.html";
  }

  // Stock market random graph
  const canvas = document.getElementById('stockCanvas');
  const ctx = canvas.getContext('2d');
  function drawGraph() {
    const w = canvas.width;
    const h = canvas.height;
    ctx.clearRect(0, 0, w, h);
    ctx.beginPath();
    ctx.moveTo(0, h/2);
    for (let x=0; x<w; x+=20) {
      const y = h/2 + Math.sin(x/50 + Date.now()/1000)*50*Math.random();
      ctx.lineTo(x, y);
    }
    ctx.strokeStyle = "#1a73e8";
    ctx.lineWidth = 3;
    ctx.stroke();
  }
  setInterval(drawGraph, 800);

  // Ads
  const adsContainer = document.getElementById('adsContainer');
  const listings = JSON.parse(localStorage.getItem('marketListings') || "[]");
  if (listings.length === 0) {
    adsContainer.innerHTML = "<p>No listings yet. Visit the marketplace to start selling!</p>";
  } else {
    const randomAds = listings.slice(0, 3);
    randomAds.forEach(ad => {
      const div = document.createElement('div');
      div.className = "ad-card";
      div.innerHTML = `<h3>${ad.name}</h3><p>${ad.price} Credits</p>`;
      adsContainer.appendChild(div);
    });
  }

  // Admin section
  const adminBtn = document.getElementById('adminBtn');
  if (currentUser === "Alfred" || currentUser === "Lexie") {
    adminBtn.classList.add('admin-visible');
  }
  adminBtn.addEventListener('click', () => {
    if (currentUser === "Alfred" || currentUser === "Lexie") openAdmin();
  });

  function openAdmin() {
    document.getElementById('adminPanel').style.display = 'flex';
    const adminUsersDiv = document.getElementById('adminUsers');
    adminUsersDiv.innerHTML = '';
    users.forEach(u => {
      const bal = localStorage.getItem(u + "_balance") || 0;
      const w = localStorage.getItem(u + "_wage") || 50;
      adminUsersDiv.innerHTML += `
        <div class="admin-user">
          <b>${u}</b> — Balance: ${bal} — Wage: ${w}<br/>
          <label>Change Wage: </label>
          <input type="number" id="wage_${u}" value="${w}"/>
          <label>Change Balance: </label>
          <input type="number" id="bal_${u}" value="${bal}"/>
          <button onclick="saveUser('${u}')">Save</button>
        </div>`;
    });
  }

  function closeAdmin() {
    document.getElementById('adminPanel').style.display = 'none';
  }

  function saveUser(u) {
    const newWage = parseInt(document.getElementById('wage_'+u).value);
    const newBal = parseInt(document.getElementById('bal_'+u).value);
    localStorage.setItem(u + "_wage", newWage);
    localStorage.setItem(u + "_balance", newBal);
    alert(`${u}'s data updated.`);
  }
</script>
</body>
</html>
